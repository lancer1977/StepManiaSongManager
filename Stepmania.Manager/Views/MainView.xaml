<Window x:Class="Stepmania.Manager.Views.Main"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
        xmlns:converters="clr-namespace:Stepmania.Manager.Converters"
        mc:Ignorable="d"
        Title="StepMania Song Tool" Height="850" Width="1000"
        Background="{StaticResource TronDarkBrush}">
    <Window.Resources>
        <converters:NullToCollapsed x:Key="NullToCollapsed" />
        <converters:UriToCachedImageConverter x:Key="UrlCacher"/>
        <converters:InvertedBoolConverter x:Key="InvertedBoolConverter" />
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <converters:InvertedBoolToVisibilityConverter x:Key="InvertedBoolToVisibilityConverter" />
        <converters:StringToBrushColorConverter x:Key="StringToBrushColorConverter" />

        <!-- Difficulty badge: keep color, monospace -->
        <Style x:Key="DifficultyBadge" TargetType="TextBlock">
            <Setter Property="Padding" Value="6,3"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="FontFamily" Value="Consolas"/>
            <Setter Property="FontSize" Value="11"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="280"/>
            <ColumnDefinition Width="4*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="1*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Left sidebar: cyan border, dark fill -->
        <Border Grid.Row="0" Grid.RowSpan="3" Background="{StaticResource TronDarkerBrush}"
                BorderBrush="{StaticResource TronCyanDimBrush}" BorderThickness="0,0,2,0"
                Margin="0,0,8,0" Padding="8,12">
            <StackPanel>
                <!-- StepMania Instance (the installation you edit) -->
                <TextBlock Foreground="{StaticResource TronCyanBrush}" FontWeight="SemiBold" Margin="0,0,0,4">StepMania Instance</TextBlock>
                <TextBlock Foreground="{StaticResource TronTextDimBrush}" FontSize="10" Margin="0,0,0,4" TextWrapping="Wrap">Installation folder you are editing</TextBlock>
                <Grid HorizontalAlignment="Stretch" Margin="0,0,0,6">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Label VerticalAlignment="Center">Instance path:</Label>
                    <TextBox Grid.Column="1" Text="{Binding StepManiaFolder}" Margin="0,0,0,6"/>
                </Grid>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                    <Button Command="{Binding RefreshListCommand}" Margin="0,0,6,0">Refresh Instance</Button>
                    <Button Command="{Binding StopMusicCommand}">Stop Play</Button>
                </StackPanel>
                <Button Command="{Binding CreatePlayListCommand}" Margin="0,0,0,12">Create New Playlist</Button>

                <Label Margin="0,8,0,4" FontSize="13">Instance Playlists</Label>
                <ListBox ItemsSource="{Binding Items}" HorizontalAlignment="Stretch" SelectedItem="{Binding SelectedPlayList}"
                         MinHeight="80" Margin="0,0,0,8">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel HorizontalAlignment="Stretch">
                                <TextBlock Text="{Binding Name}"/>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <!-- Song Repository (independent store) -->
                <TextBlock Foreground="{StaticResource TronCyanBrush}" FontWeight="SemiBold" Margin="0,12,0,4">Song Repository</TextBlock>
                <TextBlock Foreground="{StaticResource TronTextDimBrush}" FontSize="10" Margin="0,0,0,4" TextWrapping="Wrap">Network or local store of songs (analyzed folders)</TextBlock>
                <Grid HorizontalAlignment="Stretch" Margin="0,0,0,6">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Label VerticalAlignment="Center">Repository path:</Label>
                    <TextBox Grid.Column="1" Text="{Binding SongRepositoryFolder}" Margin="0,0,0,6"/>
                </Grid>
                <Button Command="{Binding RefreshRepositoryCommand}" Margin="0,0,0,8">Refresh Repository</Button>
                <Label Margin="0,0,0,4" FontSize="12">Repository categories</Label>
                <ListBox ItemsSource="{Binding RepositoryItems}" HorizontalAlignment="Stretch" SelectedItem="{Binding SelectedRepositoryPlayList}"
                         MinHeight="80" Margin="0,0,0,8">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel HorizontalAlignment="Stretch">
                                <TextBlock Text="{Binding Name}"/>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <Label Margin="0,8,0,4">Destination (instance)</Label>
                <ComboBox ItemsSource="{Binding Path=Items}" SelectedItem="{Binding Path=MovingPlayListSelection}" Margin="0,0,0,8"/>

                <TextBox Text="{Binding SearchText}" Margin="0,0,0,6"/>
                <Button Command="{Binding SearchCommand}">Search</Button>

                <!-- Danger zone -->
                <Border Margin="0,16,0,0" Padding="8,8" BorderBrush="{StaticResource TronOrangeDimBrush}" BorderThickness="1" Background="#1A0D00">
                    <StackPanel>
                        <Label Foreground="{StaticResource TronOrangeBrush}" FontSize="12" Margin="0,0,0,6">Dangerous!</Label>
                        <Button Command="{Binding AllOggToMp3Command}" Style="{StaticResource DangerButton}" Margin="0,0,0,6">All OGG to MP3</Button>
                        <TextBlock Foreground="{StaticResource TronTextDimBrush}" FontSize="10" TextWrapping="Wrap" Margin="0,0,0,4">Moves dwi to dwi.unused if a SM file exists</TextBlock>
                        <Button Command="{Binding DWICleanupCommand}" Style="{StaticResource DangerButton}">DWI Cleaner</Button>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Border>

        <!-- Main content: grid background -->
        <Grid Grid.Column="1" Grid.RowSpan="3" Background="{StaticResource TronGridBackground}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Title: instance playlist or repository category -->
            <Border Grid.Row="0" Padding="12,8" BorderBrush="{StaticResource TronCyanDimBrush}" BorderThickness="0,0,0,1" Margin="0,0,0,4">
                <TextBlock Text="{Binding DisplayedTitle}" FontSize="18" Foreground="{StaticResource TronCyanBrush}" FontWeight="SemiBold"/>
            </Border>

            <ListBox Grid.Row="1" ItemsSource="{Binding DisplayedSongs}" VerticalAlignment="Stretch" HorizontalAlignment="Stretch"
                     BorderThickness="0" Background="Transparent">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Border Margin="0,0,0,6" BorderBrush="{StaticResource TronCyanDimBrush}" BorderThickness="1"
                                Background="{Binding Color, Converter={StaticResource StringToBrushColorConverter}}"
                                Padding="0">
                            <Border.Effect>
                                <DropShadowEffect Color="#00D4FF" BlurRadius="0" ShadowDepth="0" Opacity="0.15"/>
                            </Border.Effect>
                            <Grid IsEnabled="{Binding Moved, Converter={StaticResource InvertedBoolConverter}}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="1*"/>
                                </Grid.ColumnDefinitions>
                                <Image MaxHeight="100" MaxWidth="250" MinWidth="250" Stretch="Fill" Source="{Binding ThumbNailFile, Converter={StaticResource UrlCacher}}"/>

                                <StackPanel Grid.Column="1" MinWidth="500" Margin="12,8">
                                    <TextBlock Text="{Binding ArtistName}" Foreground="{StaticResource TronTextBrush}"/>
                                    <TextBlock Text="{Binding Title}" FontWeight="SemiBold" Foreground="{StaticResource TronTextBrush}" Margin="0,2,0,6"/>

                                    <StackPanel Visibility="{Binding Path=StepFile, Converter={StaticResource NullToCollapsed}}">
                                        <TextBlock Text="{Binding StepFile}" Visibility="Collapsed"/>
                                        <TextBlock Text="StepMania" FontStyle="Italic" Foreground="{StaticResource TronCyanDimBrush}" Margin="0,2,0,2"/>
                                        <StackPanel Orientation="Horizontal" converters:MarginSetter.Margin="5">
                                            <TextBlock Style="{StaticResource DifficultyBadge}" Background="#1A4D1A" Text="{Binding StepBeginner}" Visibility="{Binding Path=StepBeginner, Converter={StaticResource NullToCollapsed}}"/>
                                            <TextBlock Style="{StaticResource DifficultyBadge}" Background="#4D4D1A" Text="{Binding StepEasy}" Visibility="{Binding Path=StepEasy, Converter={StaticResource NullToCollapsed}}"/>
                                            <TextBlock Style="{StaticResource DifficultyBadge}" Background="#4D3A1A" Text="{Binding StepMedium}" Visibility="{Binding Path=StepMedium, Converter={StaticResource NullToCollapsed}}"/>
                                            <TextBlock Style="{StaticResource DifficultyBadge}" Background="#4D1A1A" Text="{Binding StepHard}" Visibility="{Binding Path=StepHard, Converter={StaticResource NullToCollapsed}}"/>
                                            <TextBlock Style="{StaticResource DifficultyBadge}" Background="#3A1A4D" Text="{Binding StepChallenge}" Visibility="{Binding Path=StepChallenge, Converter={StaticResource NullToCollapsed}}"/>
                                        </StackPanel>
                                    </StackPanel>

                                    <StackPanel Visibility="{Binding Path=DwiFile, Converter={StaticResource NullToCollapsed}}">
                                        <TextBlock Text="{Binding DwiFile}" Visibility="Collapsed"/>
                                        <TextBlock Text="DWI" FontStyle="Italic" Foreground="{StaticResource TronCyanDimBrush}" Margin="0,2,0,2"/>
                                        <StackPanel Orientation="Horizontal" converters:MarginSetter.Margin="5">
                                            <TextBlock Style="{StaticResource DifficultyBadge}" Background="#1A4D1A" Text="{Binding DwiBeginner}" Visibility="{Binding Path=DwiBeginner, Converter={StaticResource NullToCollapsed}}"/>
                                            <TextBlock Style="{StaticResource DifficultyBadge}" Background="#4D4D1A" Text="{Binding DwiBasic}" Visibility="{Binding Path=DwiBasic, Converter={StaticResource NullToCollapsed}}"/>
                                            <TextBlock Style="{StaticResource DifficultyBadge}" Background="#4D3A1A" Text="{Binding DwiAnother}" Visibility="{Binding Path=DwiAnother, Converter={StaticResource NullToCollapsed}}"/>
                                            <TextBlock Style="{StaticResource DifficultyBadge}" Background="#4D1A1A" Text="{Binding DwiManiac}" Visibility="{Binding Path=DwiManiac, Converter={StaticResource NullToCollapsed}}"/>
                                        </StackPanel>
                                    </StackPanel>

                                    <TextBlock Text="{Binding MusicFile, StringFormat='Music: {0}'}" Visibility="Collapsed"/>
                                    <TextBlock Text="{Binding DuplicateFolder, StringFormat='Duplicate Found at: {0}'}" Visibility="{Binding DuplicateFolder, Converter={StaticResource NullToCollapsed}}"
                                               Foreground="{StaticResource TronOrangeBrush}" Margin="0,2,0,0"/>

                                    <StackPanel Orientation="Horizontal" converters:MarginSetter.Margin="5" Margin="0,8,0,0">
                                        <Button Command="{Binding Path=DataContext.PlayCommand, RelativeSource={RelativeSource AncestorType=Window}}" IsEnabled="{Binding IsMP3}" CommandParameter="{Binding MusicFile}">Play Song</Button>
                                        <Button Command="{Binding Path=DataContext.OpenFolderCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding RootDirectory}">Open Folder</Button>
                                        <Button Visibility="{Binding Path=VideoFile, Converter={StaticResource NullToCollapsed}}" Command="{Binding Path=DataContext.OpenVideoCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding VideoFile}">Play Video</Button>
                                        <!-- Copy from Repository to Instance (visible only when viewing repository) -->
                                        <Button Command="{Binding Path=DataContext.CopyFromRepositoryToInstanceCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding .}"
                                                Visibility="{Binding Path=DataContext.IsRepositoryView, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BoolToVisibilityConverter}}">Copy to Instance</Button>
                                        <!-- Instance-only actions (hidden when viewing repository) -->
                                        <Button Command="{Binding Path=DataContext.MoveCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding .}"
                                                Visibility="{Binding Path=DataContext.IsRepositoryView, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource InvertedBoolToVisibilityConverter}}">Move</Button>
                                        <Button Command="{Binding Path=DataContext.CopyCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding .}"
                                                Visibility="{Binding Path=DataContext.IsRepositoryView, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource InvertedBoolToVisibilityConverter}}">Copy</Button>
                                        <Button Command="{Binding Path=DataContext.DuplicateAsSmsModdedCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding .}"
                                                Visibility="{Binding Path=DataContext.IsRepositoryView, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource InvertedBoolToVisibilityConverter}}">Duplicate [SMS Modded]</Button>
                                        <Button Command="{Binding Path=DataContext.RemoveJumpsCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding .}">
                                            <Button.Style>
                                                <Style TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Path=DataContext.IsRepositoryView, RelativeSource={RelativeSource AncestorType=Window}}" Value="True">
                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding SmFile}" Value="{x:Null}">
                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding SmFile}" Value="">
                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Button.Style>
                                            Remove Jumps
                                        </Button>
                                        <Button Command="{Binding Path=DataContext.DeleteCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding .}"
                                                Visibility="{Binding Path=DataContext.IsRepositoryView, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource InvertedBoolToVisibilityConverter}}">Delete</Button>
                                        <Button Command="{Binding Path=DataContext.ReplaceOggCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding .}">
                                            <Button.Style>
                                                <Style TargetType="Button" BasedOn="{StaticResource DangerButton}">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Path=DataContext.IsRepositoryView, RelativeSource={RelativeSource AncestorType=Window}}" Value="True">
                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding IsMP3}" Value="True">
                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Button.Style>
                                            Ogg2Mp3
                                        </Button>
                                    </StackPanel>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </Grid>
    </Grid>
</Window>
